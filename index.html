<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>WireGuard Config Generator by Stark Industries</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f2f7ff; font-family: 'Segoe UI', sans-serif; }
        .container { margin-top: 40px; background-color: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h2 { margin-bottom: 20px; }
        textarea { height: 120px; }
        img { width: 200px; margin-top: 15px; }
    </style>
</head>
<body>
<div class="container">
    <h2>WireGuard Generator <small class="text-muted">by Stark Industries</small></h2>
    <form method="POST">
        <select class="form-select" name="mode" onchange="toggleServerFields(this.value)">
            <option value="existing">Solo añadir cliente (servidor existente)</option>
            <option value="new_server">Configurar servidor nuevo</option>
        </select>

        <div id="server_fields" class="mt-2" style="display:none;">
            <input class="form-control" name="interface_ip" placeholder="IP interfaz servidor (ej: 10.99.99.1)">
        </div>

        <input class="form-control mt-2" name="iface_name" placeholder="Nombre Interfaz (ej: wireguard)" value="wireguard">
        <input class="form-control mt-2" name="endpoint" placeholder="IP pública o dominio" required>
        <input class="form-control mt-2" name="port" placeholder="Puerto" value="13231" required>

        <div id="existing_fields" class="mt-2">
            <input class="form-control" name="server_public" placeholder="Clave pública del servidor MikroTik">
        </div>

        <input class="form-control mt-2" name="client_ip" placeholder="IP Cliente (ej: 10.99.99.2)" required>
        <input class="form-control mt-2" name="allowed_ips" placeholder="Allowed IPs" value="12.12.0.0/16" required>
        <input class="form-control mt-2" name="client_name" placeholder="Nombre del cliente (comentario MikroTik)" required>

        <button class="btn btn-primary mt-3">Generar configuración</button>
    </form>

    {% if result %}
        <hr>
        <h5>Archivo .conf Cliente</h5>
        <textarea class="form-control">{{ result.client_config }}</textarea>
        <a href="{{ url_for('download_conf', name=request.form['client_name'], data=result.client_config) }}" class="btn btn-success mt-2">Descargar .conf</a>

        <h5 class="mt-3">Comando MikroTik</h5>
        <textarea class="form-control">{{ result.mikrotik_peer_cmd }}</textarea>

        {% if server_config %}
            <h5 class="mt-3">Configuración servidor MikroTik</h5>
            <textarea class="form-control">{{ server_config }}</textarea>
        {% endif %}

        <h5 class="mt-3">Código QR</h5>
        <img src="data:image/png;base64,{{ qr_img }}" alt="QR WireGuard">
    {% endif %}
</div>

<script>
function toggleServerFields(value){
    document.getElementById('server_fields').style.display = (value=='new_server') ? 'block':'none';
    document.getElementById('existing_fields').style.display = (value=='existing') ? 'block':'none';
}
</script>

</body>
</html>